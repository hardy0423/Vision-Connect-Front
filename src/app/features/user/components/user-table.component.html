<div>
  <div class="flex items-center justify-between">
    <h1 style="font-size: 20px" class="text-custom-gray ml-5">
      {{ "user.user_list" | translate }}
    </h1>
    <div class="flex">
      <button
        mat-raised-button
        color="accent"
        (click)="openModal(true, userData)"
      >
        {{ "user.add" | translate }}
      </button>
    </div>
  </div>
  <section class="user-container mt-5 z-0" tabindex="0">
    <div class="w-full md:overflow-x-auto lg:overflow-visible">
      @if (isLoading) {
      <div class="flex justify-center p-4">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
      } @else if (totalCount == 0) {
      <p
        class="text-center text-lg font-semibold text-redscale p-4 bg-primary/10 border-l-4 border-redscale rounded-lg"
      >
        {{ "user.not_user" | translate }}
      </p>

      }@else {
      <table
        mat-table
        [dataSource]="dataSource"
        class="mt-3 pt-4 w-full table-auto"
      >
        <ng-container
          *ngFor="let column of displayedColumns"
          [matColumnDef]="column.name"
        >
          <th
            mat-header-cell
            *matHeaderCellDef
            class="p-3 text-left text-sm font-medium text-gray-700 bg-gray-100"
          >
            @if(column.name == 'is_active') {
            <mat-form-field class="w-full mt-1">
              <mat-label>{{ column.title }}</mat-label>
              <mat-select
                (selectionChange)="applySelectFilter($event, column.name)"
                class="text-sm"
              >
                <mat-option value="true">{{
                  "user.actif" | translate
                }}</mat-option>
                <mat-option value="false">{{
                  "user.inactif" | translate
                }}</mat-option>
                <mat-option value="">{{ "user.all" | translate }}</mat-option>
              </mat-select>
            </mat-form-field>
            } @else if(column.name == 'companies') {
            <mat-form-field class="w-full mt-1">
              <mat-label>{{ column.title }}</mat-label>
              <mat-select
                (selectionChange)="applyCompanyFilter($event, column.name)"
                class="text-sm"
              >
                <mat-option
                  *ngFor="let company of companyList"
                  [value]="company.name"
                >
                  {{ company.name }}
                </mat-option>
                <mat-option value="">{{
                  "user.all_companies" | translate
                }}</mat-option>
              </mat-select>
            </mat-form-field>
            } @else {
            <mat-form-field class="w-full mt-1">
              <mat-label>{{ column.title }}</mat-label>
              <mat-icon matPrefix>search</mat-icon>
              <input
                matInput
                type="text"
                (keyup)="applyFilter($event, column.name)"
                placeholder="Rechercher..."
                class="text-sm"
              />
            </mat-form-field>
            }
          </th>

          <td
            mat-cell
            *matCellDef="let element"
            class="p-3 text-sm text-gray-800"
          >
            <ng-container *ngIf="column.name === 'companies'">
              {{ element.companies?.name || "" }}
            </ng-container>

            <ng-container *ngIf="column.name === 'is_active'; else normalCell">
              {{ element.is_active ? "Actif" : "Inactif" }}
            </ng-container>

            <ng-template #normalCell>
              <ng-container *ngIf="column.name !== 'companies'">
                {{ element[column.name] }}
              </ng-container>
            </ng-template>
          </td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="text-sm font-medium text-gray-700 bg-gray-100"
          >
            <span class="flex justify-center">
              {{ "user.column_titles.actions" | translate }}</span
            >
          </th>
          <td mat-cell *matCellDef="let element" class="p-3 text-center">
            <div class="flex justify-center space-x-2">
              <!-- Bouton Restore -->
              <button
                mat-icon-button
                color="primary"
                matTooltip="Restaurer"
                (click)="deleteOrRestoreUser(element, false)"
                *ngIf="!element.is_active"
              >
                <mat-icon class="w-5 h-5">restore</mat-icon>
              </button>
              <ng-container *ngIf="element.is_active">
                <button
                  mat-icon-button
                  color="primary"
                  matTooltip="Modifier"
                  (click)="openModal(false, element)"
                >
                  <mat-icon class="w-5 h-5">edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="accent"
                  matTooltip="DÃ©sactiver"
                  (click)="deleteOrRestoreUser(element, true)"
                  [disabled]="!userData || element.uid === userData.uid"
                >
                  <mat-icon class="w-5 h-5">block</mat-icon>
                </button>
              </ng-container>
            </div>
          </td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="columnNames"
          class="sticky top-0"
        ></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: columnNames"
          class="hover:bg-gray-50 transition-colors"
        ></tr>
      </table>
      }
    </div>
    <mat-paginator
      *ngIf="totalCount > 0"
      [length]="totalCount"
      [pageSize]="limit"
      [pageSizeOptions]="[10, 25, 50, 100]"
      (page)="onPageChange($event)"
      aria-label="Select page"
    >
    </mat-paginator>
  </section>
</div>
<lib-toastify-toast-container
  [position]="'bottom-left'"
></lib-toastify-toast-container>
